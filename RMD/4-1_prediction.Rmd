---
title: "Simple Linear Regression"
author: "[Logan Kelly](https://github.com/Econometrics-UWRF)"
date: "Last updated: `r format(Sys.time(), '%B %Y')`"
output:
  html_document:
    css: style.css
    theme: spacelab
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: true
    toc_depth: 3
    number_sections: false
    code_download: false
link-citations: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo=F,message=F,warning=F,results='hide'}
if (!require("tidyverse")) install.packages("tidyverse")
  suppressMessages(library(tidyverse))

if (!require("psych")) install.packages("psych")
  suppressMessages(library(psych))

if (!require("lmtest")) install.packages("lmtest")
  suppressMessages(library(lmtest))

if (!require("sandwich")) install.packages("sandwich")
  suppressMessages(library(sandwich))

if (!require("PoEdata")) install.packages("PoEdata")
  suppressMessages(library(PoEdata))

if (!require("jtools")) install.packages("jtools")
  suppressMessages(library(jtools))

if (!require("tutorial")) install.packages("tutorial")
  suppressMessages(library(tutorial))

if (!require("testwhat")) install_github("datacamp/testwhat")
  suppressMessages(library(testwhat))
```

```{r, include=FALSE}
tutorial::go_interactive(greedy = F, height = 400)
```



<script>var element =  $("div[class="book"]");element.classList.remove("with-summary");</script>

# Introduction {.tabset}

In this tutorial, we will estimate a simple linear regression, make a scatter plot of the data that includes the regression line, and calculate a predicted value for the dependent variable.

# Importing data into R {.tabset .fixed-height}

## Lecture

<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/qPk0YEKhqB8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## Explanition

For this tutorial, we will be using the `food` data from PoE that can be found at http://www.principlesofeconometrics.com/poe5/poe5data.html. To make it easier to access this data, I have set up a shortened URL: http://tiny.cc/poe-data. Thus, to load `food.csv` into R, use the following URL: http://tiny.cc/poe-data/food.csv. We will use the `read.csv()` function along with the `url()` function as follows.

```{r LoadData, echo=T}
food <- read.csv(url("http://tiny.cc/poe-data/food.csv"))
```

`<-` is the assignment operator. It is used to store something “into” a an object or variable. For now, think of an object as a box, and `<-` puts stuff in the box. So in the code fragment above, we are storing the data into an object called `food`.

`food` is a special object called a data frame. You can think of a data frame as one page of an workbook from a spreadsheet program.

We need to use the `url()` function because we are accessing the data file from the internet. If you access data locally, you do not need the `url()` function.

## You try

Load the food data set into a data frame named food

```{r tut=T, ex="LoadDataEX", type="sample-code"}
# load data into an object called food
```

```{r tut=T, ex="LoadDataEX", type="solution"}
food <- read.csv(url("http://tiny.cc/poe-data/food.csv"))
```

```{r tut=T, ex="LoadDataEX", type="sct"}
test_object(c("food"))
success_msg("Great!")
```

# Estimate a linear model {.tabset .fixed-height}

## Lecture

## Explanition


In r, the `lm()` function is used to estimate linear regression models. The "lm" stands for linear model. `lm()` used by itself does not show any output; thus, it is useful to give the model a name, such as `mod1`, then show the results using `summary(mod1)`.

```{r echo=TRUE}
mod1 <- lm(food_exp ~ income, data = food)
summary(mod1)
```


## You try

Regress `food_exp` on `income` and store the model in an object named `mod1` then display a summary of the model.

```{r tut=T, ex="EstEX", type="pre-exercise-code"}
food <- read.csv(url("http://tiny.cc/poe-data/food.csv"))

```

```{r tut=T, ex="EstEX", type="sample-code"}
# store linear model in an object named 'mod1'

```

```{r tut=T, ex="EstEX", type="solution"}
mod1 <- lm(food_exp ~ income, data = food)
summary(mod1)
```

```{r tut=T, ex="EstEX", type="sct"}
test_object(c("mod1"))
success_msg("Great!")
```

# Plot the model {.tabset .fixed-height}

## Lecture

## Explanition

It is always a good idea to plot the data along with the regression line. The `plot()` function and do this, and the `abline()` function add the regression line.  `abline()` requires the coefficients. We can also retrieve the coefficients using the `coef()` function.

```{r echo=TRUE}
b1 <- coef(mod1)[[1]]
b2 <- coef(mod1)[[2]]

plot(food$income, food$food_exp, 
     xlab="weekly income in $100", 
     ylab="weekly food expenditure in $", 
     type = "p")
abline(b1,b2)
```


## You try

Retrieve the regression line coefficients and then plot the data and regression line.

```{r tut=T, ex="PlotEX", type="pre-exercise-code"}
food <- read.csv(url("http://tiny.cc/poe-data/food.csv"))
mod1 <- lm(food_exp ~ income, data = food)
```

```{r tut=T, ex="PlotEX", type="sample-code"}
# store linear model in an object named 'mod1'

```

```{r tut=T, ex="PlotEX", type="solution"}
b1 <- coef(mod1)[[1]]
b2 <- coef(mod1)[[2]]

plot(food$income, food$food_exp, 
     xlab="weekly income in $100", 
     ylab="weekly food expenditure in $", 
     type = "p")
abline(b1,b2)
```

```{r tut=T, ex="PlotEX", type="sct"}
test_object(c("b1","b2"))
success_msg("Great!")
```

# Prediction {.tabset .fixed-height}

## Lecture

## Explanition

The `predict()` function can be used in R to calculate the predicted value of the dependent variable, `food_exp` for given values of income, as well as the confidence and prediction intervals for that estimate. Let's predict the level of expenditure on food, `food_exp`, when income equals 20.

First, we need to create a new data frame that contains the values of the dependent variable for which we want a prediction. The function `data.frame()` is used to create the new data frame. 

```{r, echo=TRUE}

new.data <- data.frame("income" = 20)

```

Second, use the `predict()` function to create objects with the confidence interval and the prediction interval. 

```{r, echo=TRUE}

predict(mod1, newdata=new.data, interval="confidence", level=0.95)

predict(mod1, newdata=new.data, interval="predict", level=0.95)
```

## You try

Calculate the predicted value of `food_exp`, as well as the confidence and prediction intervals for that estimate, when `income` is equal to 15.

```{r tut=T, ex="PredEX", type="pre-exercise-code"}
food <- read.csv(url("http://tiny.cc/poe-data/food.csv"))
mod1 <- lm(food_exp ~ income, data = food)
```

```{r tut=T, ex="PredEX", type="sample-code"}
# store confidence interval in an object named 'ci'


# store prediction interval in an object named 'pi'


```

```{r tut=T, ex="PredEX", type="solution"}
new.data <- data.frame("income" = 15)
ci <- predict(mod1, newdata=new.data, interval="confidence", level=0.95)
ci

pi <- predict(mod1, newdata=new.data, interval="predict", level=0.95)
pi
```

```{r tut=T, ex="PredEX", type="sct"}
test_object(c("ci","pi"))
success_msg("Great!")
```


